var AssetAdapter=function(){function e(){}var t=(__define,e),a=t.prototype;return a.getAsset=function(e,t,a){function n(n){t.call(a,n,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?n(i):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var BasePanel=function(e){function t(){e.call(this),GameManager.stage.addEventListener(egret.Event.RESIZE,this.onResize,this),this.onResize()}__extends(t,e);var a=(__define,t),n=a.prototype;return n.onResize=function(){this.onResizeHandler()},n.onResizeHandler=function(){this.height=GameManager.stage.stageHeight},n.childrenCreated=function(){LayerManager.fixScreen(),this.init()},n.init=function(){},t}(eui.Component);egret.registerClass(BasePanel,"BasePanel");var GameManager=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(GameManager,"GameManager");var LayerManager=function(){function e(){}var t=(__define,e);t.prototype;return e.init=function(t){GameManager.stage=t,t.addChild(e.gameLayer),t.addChild(e.alertLayer)},e.fixScreen=function(){egret.Capabilities.isMobile?GameManager.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH:GameManager.stage.scaleMode=egret.StageScaleMode.SHOW_ALL},e.alertLayer=new egret.Sprite,e.gameLayer=new egret.Sprite,e}();egret.registerClass(LayerManager,"LayerManager");var EndGamePanel=function(e){function t(){e.call(this),this.skinName="EndGamePanelSkin"}__extends(t,e);var a=(__define,t),n=a.prototype;return n.init=function(){var e=this;this.againBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){LayerManager.gameLayer.removeChild(e);var t=new GamePanel;LayerManager.gameLayer.addChild(t)},this),this.shareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showMask,this)},n.setResult=function(e,t,a){this.scoreTxt.text="总分："+t,this.descTxt.text=e,this.titleTxt.text="头衔："+a;var n="获得"+t+"分，收获"+a+"称号，"+e;share(n)},n.showMask=function(){null==this.sp&&(this.sp=new egret.Sprite,this.shareTip=new egret.Bitmap,this.shareTip.texture=RES.getRes("share_tip_png"),this.shareTip.x=GameManager.stage.stageWidth-320,this.sp.addChild(this.shareTip)),this.sp.graphics.clear(),this.sp.graphics.beginFill(0,.7),this.sp.touchEnabled=!0,this.sp.graphics.drawRect(0,0,GameManager.stage.stageWidth,GameManager.stage.stageHeight),this.sp.graphics.endFill(),this.sp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancle,this),LayerManager.alertLayer.addChild(this.sp)},n.onCancle=function(e){LayerManager.alertLayer.removeChild(this.sp)},t}(BasePanel);egret.registerClass(EndGamePanel,"EndGamePanel");var GameData=function(){function e(){}var t=(__define,e);t.prototype;return e.createQuest=function(e){var t,a=Math.ceil(Math.random()*e),n=Math.ceil(Math.random()*e),i=a+n,r=i-Math.ceil(Math.ceil(.3*i)*Math.random());t=10>=i?i-Math.ceil(Math.ceil(.3*i)*Math.random()):Math.ceil(10*Math.random())%2==0?i-10:i+10,t==r&&(t+=10);var s=[],o=Math.random();s=.5>o?[i,r,t]:o>.5&&.7>o?[r,i,t]:o>=.7&&.8>=o?[r,t,i]:o>=.9?[t,i,r]:[t,r,i];var h={label:a+"+"+n+"=?",qs:s,result:i+""};return h},e.getResult=function(e){return 10>=e?"看来你的算术已经连小学生都不如":e>10&&20>=e?"看似还行，还是回去练练吧":e>20&&40>=e?"数学不错喔，不要骄傲。你已经击败了很多人":e>40&&60>e?"数学心算高手，击败了全国80%的人":"我已经是算术大神，击败了全国90%的人，谁不服来挑战我"},e.getTitle=function(e){return 10>=e?"傻逼":e>10&&20>=e?"小学生":e>20&&40>=e?"心算中级生":e>40&&60>e?"算术大牛":"精算师"},e.levelNumber=10,e}();egret.registerClass(GameData,"GameData");var GamePanel=function(e){function t(){e.call(this),this.totalTime=4,this.score=0,this.skinName="GamePanelSkin"}__extends(t,e);var a=(__define,t),n=a.prototype;return n.init=function(){var e=this;this.timer=new egret.Timer(1e3),this.timer.addEventListener(egret.TimerEvent.TIMER,function(){e.totalTime--,e.totalTime>0?e.timeTxt.text=e.totalTime+"":e.gameOver()},this),this.initGameEvent(),this.initData()},n.initData=function(){GameData.levelNumber=10,this.nextQues()},n.nextQues=function(){this.totalTime=4,this.timeTxt.text=this.totalTime+"",this.isSelected=!1,this.timer.start();var e=this.getLevel();this.curQuesData=GameData.createQuest(e),null!=this.curQuesData&&this.setButtonState(this.curQuesData.qs,this.curQuesData.label)},n.setButtonState=function(e,t){this.aBtn.labelDisplay.text=e[0].toString(),this.bBtn.labelDisplay.text=e[1].toString(),this.cBtn.labelDisplay.text=e[2].toString(),this.quesTxt.text=t},n.getLevel=function(){return this.score>GameData.levelNumber&&(GameData.levelNumber+=20),GameData.levelNumber},n.initGameEvent=function(){this.aBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelect,this),this.bBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelect,this),this.cBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelect,this),this.resetBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReset,this)},n.onSelect=function(e){this.isSelected=!0;var t=e.currentTarget;this.checkRight(t.labelDisplay.text)},n.onReset=function(e){this.timer.stop(),LayerManager.gameLayer.removeChild(this);var a=new t;LayerManager.gameLayer.addChild(a),this.nextQues()},n.gameOver=function(){this.timer.stop();var e=this.score;LayerManager.gameLayer.removeChild(this);var t=new EndGamePanel,a=GameData.getResult(e),n=GameData.getTitle(e);t.setResult(a,e,n),LayerManager.gameLayer.addChild(t)},n.checkRight=function(e){null!=this.curQuesData&&(e==this.curQuesData.result?(this.score++,this.mycurNumTxt.text="当前分数："+this.score,this.nextQues()):this.gameOver())},t}(BasePanel);egret.registerClass(GamePanel,"GamePanel");var WelcomePanel=function(e){function t(){e.call(this),this.skinName="WelcomePanelSkin"}__extends(t,e);var a=(__define,t),n=a.prototype;return n.init=function(){this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartGame,this)},n.onStartGame=function(e){LayerManager.gameLayer.removeChild(this);var t=new GamePanel;LayerManager.gameLayer.addChild(t)},t}(BasePanel);egret.registerClass(WelcomePanel,"WelcomePanel");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var a=(__define,t),n=a.prototype;return n.createView=function(){var e=RES.getRes("loading_json"),t=RES.getRes("loading_png"),a=new egret.MovieClipDataFactory(e,t);this.mcLoading=new egret.MovieClip(a.generateMovieClipData("loading")),this.mcLoading.x=200,this.mcLoading.y=200,this.addChild(this.mcLoading),this.mcLoading.play(-1)},n.setProgress=function(e,t){e==t&&this.mcLoading.stop()},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var a=(__define,t),n=a.prototype;return n.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("loading")},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(e){"preload"==e.groupName?(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene()):"loading"==e.groupName&&(this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.loadGroup("preload"))},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},n.startCreateScene=function(){LayerManager.init(this.stage);var e=new WelcomePanel;LayerManager.gameLayer.addChild(e)},n.createBitmapByName=function(e){var t=new egret.Bitmap,a=RES.getRes(e);return t.texture=a,t},n.startAnimation=function(e){for(var t=this,a=new egret.HtmlTextParser,n=[],i=0;i<e.length;i++)n.push(a.parser(e[i]));var r=t.textfield,s=-1,o=function(){s++,s>=n.length&&(s=0);var e=n[s];t.changeDescription(r,e);var a=egret.Tween.get(r);a.to({alpha:1},200),a.wait(2e3),a.to({alpha:0},200),a.call(o,t)};o()},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),a=t.prototype;return a.getTheme=function(e,t,a,n){function i(e){t.call(n,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),a.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);